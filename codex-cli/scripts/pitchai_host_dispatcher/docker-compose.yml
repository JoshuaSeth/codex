services:
  pitchai-codex-dispatcher:
    image: registry.pitchai.net:5000/pitchai/codex-dispatcher:latest
    container_name: pitchai-codex-dispatcher
    restart: unless-stopped
    ports:
      - "127.0.0.1:8129:8129"
    environment:
      PITCHAI_DISPATCH_TOKEN: ${PITCHAI_DISPATCH_TOKEN}
      PITCHAI_HOST_QUEUE_DIR: /data/prompts/http
      PITCHAI_HOST_RUNS_DIR: /data/runs
      # Must be a *host* absolute path (Docker daemon perspective), not a container path.
      PITCHAI_DOCKER_HOST_VOLUME_ROOT_DIR: ${PITCHAI_DOCKER_HOST_VOLUME_ROOT_DIR}
      PITCHAI_RUNNER_IMAGE: ${PITCHAI_RUNNER_IMAGE}
      PITCHAI_MAX_ITEMS_PER_RUN: ${PITCHAI_MAX_ITEMS_PER_RUN:-10}
      # Runner env is passed to the codex runner container verbatim.
      PITCHAI_RUNNER_ENV_JSON: ${PITCHAI_RUNNER_ENV_JSON:-{}}
      # Optional: protect /ui + allow browser auth for API calls.
      PITCHAI_UI_BASIC_USER: ${PITCHAI_UI_BASIC_USER:-}
      PITCHAI_UI_BASIC_PASS: ${PITCHAI_UI_BASIC_PASS:-}
    volumes:
      - ./data:/data
      - /var/run/docker.sock:/var/run/docker.sock
